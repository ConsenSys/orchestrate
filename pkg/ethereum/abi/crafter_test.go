// +build unit

package abi

import (
	"testing"

	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/stretchr/testify/assert"
)

func TestCrafter(t *testing.T) {
	c := &BaseCrafter{}
	data, err := c.CraftCall(
		"testMethod(uint256)",
		"0x2386f26fc10000",
	)
	assert.NoError(t, err, "CraftCall should not error")
	assert.Equal(
		t,
		hexutil.Encode(data),
		"0xcbef6d0e000000000000000000000000000000000000000000000000002386f26fc10000",
		"CraftCall: payload should be correct",
	)
}

func TestCraftConstructor(t *testing.T) {
	c := &BaseCrafter{}
	bytecode, _ := hexutil.Decode("0x6080604052348015600f57600080fd5b5061010a8061001f6000396000f3fe6080604052348015600f57600080fd5b506004361060285760003560e01c80637cf5dab014602d575b600080fd5b605660048036036020811015604157600080fd5b81019080803590602001909291905050506058565b005b8060008082825401925050819055507f38ac789ed44572701765277c4d0970f2db1c1a571ed39e84358095ae4eaa54203382604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a15056fea265627a7a72315820c084d653e3ba7607a5b05fb98edf3373a2b542aa6abdd9ae89cd4a407bb0a2b464736f6c63430005100032")
	data, err := c.CraftConstructor(
		bytecode,
		"constructor()",
	)
	assert.NoError(t, err, "CraftCall should not error")
	assert.Equal(
		t,
		hexutil.Encode(data),
		"0x6080604052348015600f57600080fd5b5061010a8061001f6000396000f3fe6080604052348015600f57600080fd5b506004361060285760003560e01c80637cf5dab014602d575b600080fd5b605660048036036020811015604157600080fd5b81019080803590602001909291905050506058565b005b8060008082825401925050819055507f38ac789ed44572701765277c4d0970f2db1c1a571ed39e84358095ae4eaa54203382604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a15056fea265627a7a72315820c084d653e3ba7607a5b05fb98edf3373a2b542aa6abdd9ae89cd4a407bb0a2b464736f6c63430005100032",
		"CraftCall: payload should be correct",
	)
}
